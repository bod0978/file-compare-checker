#!/bin/bash
user="db user";
pass="db pass";
db="database";
table="db table";
Gid="$1";
paths="Folder path for files to compare with the database";

DB_COUNT=$(mysql -u${user} -p${pass} -D ${db} -se "SELECT COUNT(*) FROM ${table} where GroupID='${Gid}';")
FILE_COUNT=$(ls -1 ${paths}/${Gid}/*.call | wc -l)

echo "ğŸ“Š è³‡æ–™åº«ç­†æ•¸ï¼š$DB_COUNT"
echo "ğŸ“„ TXT æª”æ¡ˆæ•¸é‡ï¼š$FILE_COUNT"

if [ "$DB_COUNT" -eq "$FILE_COUNT" ]; then
    echo "âœ… æ•¸é‡ç›¸ç¬¦ï¼Œé€²è¡Œæª”åæª¢æŸ¥..."
    
    DB_NUMBERS=$(mysql -u${user} -p${pass} -D ${db} -se "SELECT mobile1 FROM member WHERE GroupID = '${Gid}';")
    ALL_MATCHED=true

    for num in $DB_NUMBERS; do
        if [ -f "${paths}/${Gid}/${Gid}_${num}.call" ]; then
            continue;
        else
            echo "âŒ ${Gid}__${num}.call ç¼ºå¤±ï¼"
            ALL_MATCHED=false
        fi
    done

    if [ "$ALL_MATCHED" = true ]; then
        echo "âœ… æ‰€æœ‰æª”æ¡ˆåç¨±èˆ‡è³‡æ–™åº«è¨˜éŒ„ç›¸ç¬¦ï¼"
    else
        echo "âŒ å­˜åœ¨éºæ¼æˆ–å‘½åéŒ¯èª¤çš„æª”æ¡ˆï¼Œè«‹æª¢æŸ¥ï¼"
    fi
else
    echo "âŒ æ•¸é‡ä¸ç¬¦ï¼Œè«‹æª¢æŸ¥æª”æ¡ˆç”¢ç”Ÿéç¨‹ï¼"
fi
